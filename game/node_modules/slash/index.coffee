S = require './string'

module.exports = class slash
  constructor: (@dispatch) ->

  on: (command, cb) ->
    command = '/' + command.toLowerCase()
    @dispatch.hook 'cWhisper', (data) ->
      if data.target.toLowerCase() is command
        raw = data.message
        message = S.decodeHTMLEntities S.stripTags raw
        cb message, raw
        return false

  print: (message, formatted = false) ->
    message += ''

    if !formatted
      message = S.escapeHTML message

    @dispatch.toClient 'sChat',
      channel: 206
      authorID:
        high: 0
        low: 0
      unk1: 0
      gm: 0
      unk2: 0
      authorName: ''
      message: message
